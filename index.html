<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>学习越南语请联系Wx:XiDeYueNanYu</title>
    <style>
        body {
            background-color: #f7fbf3;
            margin-bottom: 60px;
        }
        #infoBox { 
            width: 100%; 
            max-width: 700px;
            height: 100px; 
            margin: 0 auto; 
            border: 1px solid #ccc; 
            background: #68838B; 
            color: #D2B48C; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: clamp(40px, 5vw, 60px);
            font-weight: bold;
        }
        #contactBox { 
            width: 100%; 
            max-width: 700px;
            height: 45px; 
            margin: 0px auto; 
            border: 1px solid #ccc; 
            background: #68838B; 
            color: #D2B48C; 
            display: flex; 
            align-items: center; 
            justify-content: left; 
            padding-left: 20px;
            font-size: clamp(12px, 2vw, 15px); 
            font-weight: bold;
        }
        .image-frame {
            max-width: 700px;
            margin: 20px auto 0 auto;
            border: 10px solid #957652;
            border-radius: 10px;
            background-color: #ffffff;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            display: none;
            overflow: hidden;
        }
        .image-frame img {
            width: 100%;
            height: auto;
            display: block;
        }
        .content-box {
            max-width: 700px;
            margin: 20px auto;
            padding: 50px;
            border: 10px solid #957652;
            border-radius: 10px;
            background-color: #ffffff;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            font-size: 30px;
            font-family: Arial;
            color: #222322;
            line-height: 3;
            text-align: justify;
        }
        .translated-word {
            position: relative;
            display: inline-block;
            white-space: nowrap;
            line-height: 1.3;
            background-color: #bfcdbf;
            color: #000000;
            padding: 4px 4px;
            border-radius: 2px;
        }
        .translation {
            position: absolute;
            top: -29px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 18px;
            background-color: #eddabc;
            color: #313a2d;
            padding: 4px 4px;
            border-radius: 1px;
            white-space: nowrap;
            z-index: 1;
            line-height: 1;
        }
        .original {
            display: inline;
            line-height: 1;
        }
        .floating-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            text-align: center;
            display: block;
            z-index: 1000;
        }
        #audioPlayer {
            width: 100%;
            margin-bottom: 10px;
        }
        .time-row {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .time-box-group {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .button-group {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .floating-controls p#timeDisplay {
            font-size: 28px;
            color: #FFFFFF;
            background-color: #000000;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            margin: 0;
        }
        .floating-controls .time-box {
            font-size: 16px;
            color: #FFFFFF;
            background-color: #555555;
            padding: 5px 10px;
            border-radius: 5px;
            min-width: 60px;
        }
        .tua-buttons {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .control-button {
            width: 50px;
            height: 50px;
            background-color: #363535;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            display: inline-flex;
            justify-content: center;
            align-items: center;
        }
        .control-button:disabled {
            background-color: #888888;
            cursor: not-allowed;
        }
        .control-button:hover:not(:disabled) {
            background-color: #000000;
        }
        .pause-play-button {
            background-color: #FF4500;
        }
        .pause-play-button:hover {
            background-color: #CC3700;
        }
        .toggle-button {
            background-color: #4682B4;
        }
        .toggle-button:hover {
            background-color: #ffffff;
        }
        .loop-button {
            background-color: #3c923c;
        }
        .loop-button:hover {
            background-color: #347d34;
        }
        .clear-button {
            background-color: #bc3f13;
        }
        .clear-button:hover {
            background-color: #d15124;
        }
        .toggle-translation-button {
            background-color: #6A5ACD;
        }
        .toggle-translation-button:hover {
            background-color: #ffffff;
        }
        .active {
            background-color: #ffffff; 
            border-radius: 5px;
        }
        @media (max-width: 400px) {
            .control-button {
                width: 40px;
                height: 40px;
                font-size: 14px;
            }
            .floating-controls p#timeDisplay {
                font-size: 20px;
            }
            .floating-controls .time-box {
                font-size: 12px;
                min-width: 50px;
            }
        }
        #quizContainer {
            display: none;
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            color: #53686f;
            font-size: 25px;
            font-weight: bold;
        }
        .question {
            margin-bottom: 20px;
            padding: 18px;
            color: #53686f;
            border: 5px solid #53686f;
            border-radius: 10px;
            background-color: #ffffff;
            font-size: 20px;
            font-weight: bold;
        }
        .options label {
            display: block;
            margin: 15px 0;
            cursor: pointer;
            color: #21292c;
            font-size: 16px;
            font-weight: bold;
        }
        #result {
            margin-top: 20px;
            padding: 10px;
            display: none;
            border: 5px solid #53686f;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            background-color: #ffffff;
            color: #007a33;
        }
        .wrong-answer {
            color: #f65936;
            margin: 10px 0;
            font-size: 16px;
            font-weight: bold;
        }
        #submitQuiz {
            font-family: Arial, sans-serif;
            padding: 10px 20px;
            border: 3px solid #53686f;
            background-color: #FF6820;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
        }
        #submitQuiz:hover {
            background-color: #ff844a;
        }
        .floating-mode-bar {
            position: fixed;
            bottom: 0px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #68838B;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 0px 5px rgba(0, 0, 0, 1);
            display: flex;
            justify-content: center;
            gap: 20px;
            z-index: 1000;
            width: 900px;
        }
        .mode-button {
            padding: 10px 20px;
            border: 0px solid #ccc;
            background: #95a8ad;
            color: #293437;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
            transition: border-color 0.3s;
        }
        .mode-button.active {
            border: 2px solid #ffffff;
            background: #f0f0f0;
            color: #293437;
        }
        /* Mobile styles */
        @media (max-width: 768px) { 
            body {
                background-color: #f7fbf3;
                margin-bottom: 60px;
            }
            #infoBox { 
                width: 90%; 
                height: 120px; 
                margin: 0 auto; 
                border: 1px solid #ccc; 
                background: #68838B; 
                color: #D2B48C; 
                display: flex; 
                align-items: center; 
                justify-content: center; 
                font-size: 60px; 
                font-weight: bold;
            }
            #contactBox { 
                width: 90%; 
                height: 50px; 
                margin: 0px auto; 
                border: 1px solid #ccc; 
                background: #68838B; 
                color: #D2B48C; 
                display: flex; 
                align-items: center; 
                justify-content: left; 
                padding-left: 20px;
                font-size: 20px; 
                font-weight: bold;
            }
            .image-frame {
                width: 90%;
                max-width: 700px;
                margin: 10 screen auto 0 auto;
                border: 10px solid #957652;
                border-radius: 10px;
                background-color: #ffffff;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
                display: none;
                overflow: hidden;
            }
            .image-frame img {
                width: 100%;
                height: auto;
                display: block;
            }
            .content-box {
                max-width: 700px;
                margin: 10px auto;
                padding: 20px;
                padding-top: 50px;
                padding-bottom: 90px;
                border: 10px solid #957652;
                border-radius: 10px;
                background-color: #ffffff;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
                font-size: 19px;
                font-family: Arial;
                color: #222322;
                line-height: 3.5;
                text-align: justify;
            }
            .translated-word {
                position: relative;
                display: inline-block;
                white-space: nowrap;
                line-height: 1.3;
                background-color: #bfcdbf;
                color: #000000;
                padding: 3px 3px;
                border-radius: 2px;
            }
            .translation {
                position: absolute;
                top: -25px;
                left: 50%;
                transform: translateX(-50%);
                font-size: 13px;
                background-color: #eddabc;
                color: #313a2d;
                padding: 4px 4px;
                border-radius: 1px;
                white-space: nowrap;
                z-index: 1;
                line-height: 1;
            }
            .original {
                display: inline;
                line-height: 1;
            }
            .floating-controls {
                position: fixed;
                top: 20px;
                right: 20px;
                background-color: #f0f0f0;
                padding: 10px;
                border-radius: 5px;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
                text-align: center;
                display: block;
                z-index: 1000;
            }
            #audioPlayer {
                width: 100%;
                margin-bottom: 10px;
            }
            .time-row {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 10px;
                margin-bottom: 10px;
            }
            .time-box-group {
                display: flex;
                justify-content: center;
                gap: 10px;
            }
            .button-group {
                display: flex;
                justify-content: center;
                gap: 10px;
            }
            .floating-controls p#timeDisplay {
                font-size: 28px;
                color: #FFFFFF;
                background-color: #000000;
                padding: 5px 10px;
                border-radius: 5px;
                cursor: pointer;
                margin: 0;
            }
            .floating-controls .time-box {
                font-size: 16px;
                color: #FFFFFF;
                background-color: #555555;
                padding: 5px 10px;
                border-radius: 5px;
                min-width: 60px;
            }
            .tua-buttons {
                display: flex;
                justify-content: center;
                gap: 5px;
                margin-bottom: 10px;
                flex-wrap: wrap;
            }
            .action-buttons {
                display: flex;
                justify-content: center;
                gap: 10px;
            }
            .control-button {
                width: 50px;
                height: 50px;
                background-color: #363535;
                color: white;
                border: none;
                border-radius: 50%;
                font-size: 16px;
                font-weight: bold;
                cursor: pointer;
                display: inline-flex;
                justify-content: center;
                align-items: center;
            }
            .control-button:disabled {
                background-color: #888888;
                cursor: not-allowed;
            }
            .control-button:hover:not(:disabled) {
                background-color: #000000;
            }
            .pause-play-button {
                background-color: #FF4500;
            }
            .pause-play-button:hover {
                background-color: #CC3700;
            }
            .toggle-button {
                background-color: #4682B4;
            }
            .toggle-button:hover {
                background-color: #36648B;
            }
            .loop-button {
                background-color: #3c923c;
            }
            .loop-button:hover {
                background-color: #347d34;
            }
            .clear-button {
                background-color: #bc3f13;
            }
            .clear-button:hover {
                background-color: #d15124;
            }
            .toggle-translation-button {
                background-color: #6A5ACD;
            }
            .toggle-translation-button:hover {
                background-color: #ffffff;
            }
            .active {
                background-color: #ffffff; 
                border-radius: 5px;
            }
            @media (max-width: 400px) {
                .control-button {
                    width: 40px;
                    height: 40px;
                    font-size: 14px;
                }
                .floating-controls p#timeDisplay {
                    font-size: 20px;
                }
                .floating-controls .time-box {
                    font-size: 12px;
                    min-width: 50px;
                }
            }
            #quizContainer {
                display: none;
                font-family: Arial, sans-serif;
                max-width: 800px;
                margin: 20px auto;
                padding: 20px;
                color: #53686f;
                font-size: 25px;
                font-weight: bold;
            }
            .question {
                margin-bottom: 20px;
                padding: 18px;
                color: #53686f;
                border: 5px solid #53686f;
                border-radius: 10px;
                background-color: #ffffff;
                font-size: 16px;
                font-weight: bold;
            }
            .options label {
                display: block;
                margin: 15px 0;
                cursor: pointer;
                color: #21292c;
                font-size: 16px;
                font-weight: bold;
            }
            #result {
                margin-top: 20px;
                padding: 10px;
                display: none;
                border: 5px solid #53686f;
                border-radius: 5px;
                font-size: 16px;
                font-weight: bold;
                background-color: #ffffff;
                color: #007a33;
            }
            .wrong-answer {
                color: #f65936;
                margin: 10px 0;
                font-size: 16px;
                font-weight: bold;
            }
            #submitQuiz {
                font-family: Arial, sans-serif;
                padding: 10px 20px;
                border: 3px solid #53686f;
                background-color: #FF6820;
                border-radius: 5px;
                color: white;
                cursor: pointer;
                font-size: 18px;
                font-weight: bold;
            }
            #submitQuiz:hover {
                background-color: #ff844a;
            }
            .floating-mode-bar {
                position: fixed;
                bottom: 0px;
                left: 50%;
                transform: translateX(-50%);
                background-color: #68838B;
                padding: 10px;
                border-radius: 5px;
                box-shadow: 0 0px 5px rgba(0, 0, 0, 1);
                display: flex;
                justify-content: center;
                gap: 20px;
                z-index: 1000;
                width: 100%;
            }
            .mode-button {
                padding: 10px 20px;
                border: 0px solid #ccc;
                background: #95a8ad;
                color: #293437;
                font-size: 20px;
                font-weight: bold;
                cursor: pointer;
                border-radius: 5px;
                transition: border-color 0.3s;
            }
            .mode-button.active {
                border: 2px solid #ffffff;
                background: #f0f0f0;
                color: #293437;
            }
        }
    </style>
</head>
<body>
    <div id="infoBox">习得越南语</div>
    <div id="contactBox">讲师-阮玉煌 | Weixin：XiDeYueNanYu</div>
    <div id="contentContainer">
        <div class="image-frame" id="imageFrame">
            <img id="contentImage" src="" alt="Content Image">
        </div>
        <div class="content-box" id="content"></div>
    </div>
    <div id="quizContainer">
        <h1>回答下面问题</h1>
        <form id="quizForm">
            <div id="questions"></div>
            <button type="button" id="submitQuiz" onclick="checkAnswers()">提交</button>
        </form>
        <div id="result"></div>
    </div>
    <div class="floating-controls" id="floatingControls">
        <audio id="audioPlayer" src="lesson.wav" controls></audio>
        <div class="time-row">
            <p id="timeDisplay">00:00</p>
            <div class="time-box-group">
                <span class="time-box" id="loopStart">--:--</span>
                <span class="time-box" id="loopEnd">--:--</span>
            </div>
            <div class="button-group">
                <button class="control-button loop-button" id="loopButton">听</button>
                <button class="control-button clear-button" id="clearButton">删</button>
            </div>
        </div>
        <div class="tua-buttons">
            <button class="control-button" id="rewind5sButton">-5s</button>
            <button class="control-button" id="rewind1sButton">-1s</button>
            <button class="control-button" id="forward1sButton">+1s</button>
            <button class="control-button" id="forward5sButton">+5s</button>
        </div>
        <div class="action-buttons">
            <button class="control-button pause-play-button" id="pausePlayButton">播</button>
            <button class="control-button toggle-button" id="toggleControlsButton">藏</button>
        </div>
    </div>
    <div class="floating-mode-bar">
        <button class="mode-button toggle-translation-button" id="toggleTranslationButton">藏</button>
        <button class="mode-button active" id="contentMode">内容</button>
        <button class="mode-button" id="quizMode">回答问题</button>
    </div>

    <script>

const textContentData = [
    `Dân ca quan họ là một di sản văn hóa độc đáo của vùng đồng bằng Bắc Bộ, nổi tiếng nhất ở tỉnh Bắc Ninh. Đây được xem là thể loại dân ca phong phú nhất về mặt giai điệu trong kho tàng âm nhạc dân gian Việt Nam. Hiện nay, đã có ít nhất 300 bài quan họ được ghi chép lại, mỗi bài đều có giai điệu riêng biệt. Phần lớn là những đoạn thơ hoặc bài thơ lục bát do các nghệ nhân truyền thống sáng tác và lưu truyền qua nhiều thế hệ.

Điểm đặc sắc của quan họ Bắc Ninh nằm ở sự kết hợp hài hòa giữa giai điệu, lời ca và trang phục truyền thống. Trang phục quan họ không chỉ đẹp mắt mà còn thể hiện nét văn hóa đặc trưng của người dân địa phương. Quan họ mang trong mình nhiều phong tục, tập quán và tín ngưỡng độc đáo, trở thành một "đặc sản văn hóa" thu hút nhiều người yêu thích nghệ thuật dân gian.

So với các loại hình nghệ thuật dân gian khác, quan họ có lịch sử lâu đời nhất, tồn tại hàng ngàn năm. Điều này chứng tỏ sức sống mạnh mẽ và bản sắc riêng của nó trong lòng người dân vùng Kinh Bắc. Hiện nay, Bắc Ninh có 44 làng vẫn duy trì lối chơi văn hóa quan họ với hàng ngàn bài hát cổ mộc mạc, dân dã.

Quan họ truyền thống thường được hát không có nhạc đệm, chủ yếu là hát đôi giữa liền anh và liền chị trong các dịp lễ hội mùa xuân ở làng quê. Hát quan họ truyền thống không có khán giả, người hát vừa là người trình diễn vừa là người thưởng thức. Điều này tạo nên không khí gần gũi và thân mật giữa những người tham gia.

Dù cuộc sống ngày càng hiện đại, nhưng khi về miền quan họ, du khách vẫn cảm nhận được không khí văn hóa đặc trưng. Mỗi làng quê, gốc đa, mái đình, bến nước đều ẩn chứa tình người quan họ. Ngoài việc thưởng thức âm nhạc, du khách còn được trải nghiệm phong tục ăn trầu và cảm nhận sự hiếu khách của người dân địa phương.

Dân ca quan họ không chỉ là di sản văn hóa của Bắc Ninh mà còn là niềm tự hào của cả dân tộc Việt Nam. Nó đã và đang được bảo tồn, phát huy để tiếp tục lan tỏa giá trị văn hóa độc đáo này đến các thế hệ mai sau. Việc gìn giữ và phát triển quan họ không chỉ giúp bảo tồn bản sắc văn hóa dân tộc mà còn góp phần quảng bá hình ảnh đất nước, con người Việt Nam ra thế giới.`
];
const dictionary = {
"quan họ": "官贺",
"di sản": "遗产",
"văn hóa": "文化",
"độc đáo": "独特",
"đồng bằng": "平原",
"Bắc Bộ": "北部",
"nổi tiếng": "著名",
"Bắc Ninh": "北宁",
"thể loại": "类型",
"dân ca": "民歌",
"phong phú": "丰富",
"giai điệu": "旋律",
"kho tàng": "宝库",
"âm nhạc": "音乐",
"dân gian": "民间",
"Việt Nam": "越南",
"ghi chép": "记录",
"riêng biệt": "独特",
"thơ": "诗",
"lục bát": "六八",
"nghệ nhân": "艺人",
"truyền thống": "传统",
"sáng tác": "创作",
"lưu truyền": "流传",
"thế hệ": "世代", "đặc sắc": "特色",
"quan họ": "官贺",
"Bắc Ninh": "北宁",
"kết hợp": "结合",
"hài hòa": "和谐",
"giai điệu": "旋律",
"lời ca": "歌词",
"trang phục": "服装",
"truyền thống": "传统",
"đẹp mắt": "美观",
"văn hóa": "文化",
"đặc trưng": "特色",
"địa phương": "地方",
"phong tục": "风俗",
"tập quán": "习俗",
"tín ngưỡng": "信仰",
"độc đáo": "独特",
"đặc sản": "特产",
"nghệ thuật": "艺术",
"dân gian": "民间", "loại hình": "类型",
"nghệ thuật": "艺术",
"dân gian": "民间",
"quan họ": "官贺",
"lịch sử": "历史",
"lâu đời": "悠久",
"tồn tại": "存在",
"hàng ngàn": "数千",
"chứng tỏ": "证明",
"sức sống": "生命力",
"mạnh mẽ": "强大",
"bản sắc": "特色",
"người dân": "人民",
"Kinh Bắc": "京北",
"Bắc Ninh": "北宁",
"làng": "村",
"duy trì": "维持",
"lối chơi": "玩法",
"văn hóa": "文化",
"bài hát": "歌曲",
"cổ": "古老",
"mộc mạc": "朴素",
"dân dã": "乡土", "truyền thống": "传统",
"hát": "唱",
"nhạc đệm": "伴奏",
"hát đôi": "对唱",
"liền anh": "郎君",
"liền chị": "娘子",
"dịp": "场合",
"lễ hội": "节日",
"mùa xuân": "春天",
"làng quê": "乡村",
"khán giả": "观众",
"người hát": "唱歌的人",
"người trình diễn": "表演者",
"người thưởng thức": "欣赏者",
"Điều này": "这一点",
"không khí": "气氛",
"gần gũi": "亲近",
"thân mật": "亲密",
"người tham gia": "参与者", "cuộc sống": "生活",
"hiện đại": "现代",
"miền": "地区",
"quan họ": "官贺",
"du khách": "游客",
"cảm nhận": "感受",
"không khí": "气氛",
"văn hóa": "文化",
"đặc trưng": "特色",
"làng quê": "乡村",
"gốc đa": "榕树根",
"mái đình": "亭顶",
"bến nước": "水码头",
"ẩn chứa": "蕴含",
"tình người": "人情",
"thưởng thức": "欣赏",
"âm nhạc": "音乐",
"trải nghiệm": "体验",
"phong tục": "风俗",
"ăn trầu": "嚼槟榔",
"sự hiếu khách": "好客",
"người dân": "居民",
"địa phương": "当地", "quan họ": "官贺",
"di sản": "遗产",
"văn hóa": "文化",
"Bắc Ninh": "北宁",
"niềm tự hào": "自豪",
"dân tộc": "民族",
"Việt Nam": "越南",
"bảo tồn": "保护",
"phát huy": "发扬",
"lan tỏa": "传播",
"giá trị": "价值",
"độc đáo": "独特",
"thế hệ": "世代",
"mai sau": "未来",
"gìn giữ": "维护",
"phát triển": "发展",
"bản sắc": "本色",
"quảng bá": "推广",
"hình ảnh": "形象",
"đất nước": "国家",
"con người": "人民",
"thế giới": "世界"
};
const quizData = [
    {
        question: "Theo đoạn trích, dân ca quan họ nổi tiếng nhất ở tỉnh nào?",
        options: ["Hà Nội", "Bắc Ninh", "Hải Phòng", "Nam Định"],
        correct: "Bắc Ninh"
    },
    {
        question: "Theo đoạn trích, dân ca quan họ có ít nhất bao nhiêu bài được ghi chép lại?",
        options: ["100 bài", "200 bài", "300 bài", "400 bài"],
        correct: "300 bài"
    },
    {
        question: "Theo đoạn trích, trang phục quan họ thể hiện điều gì?",
        options: ["Sự giàu có của người dân", "Nét văn hóa đặc trưng của người dân địa phương", "Phong cách hiện đại", "Sự ảnh hưởng của văn hóa phương Tây"],
        correct: "Nét văn hóa đặc trưng của người dân địa phương"
    },
    {
        question: "Theo đoạn trích, quan họ có lịch sử tồn tại bao nhiêu năm?",
        options: ["Hàng trăm năm", "Hàng ngàn năm", "Hàng chục năm", "Hàng triệu năm"],
        correct: "Hàng ngàn năm"
    },
    {
        question: "Theo đoạn trích, quan họ truyền thống thường được hát như thế nào?",
        options: ["Có nhạc đệm", "Không có nhạc đệm", "Chỉ có nhạc cụ dây", "Chỉ có nhạc cụ gõ"],
        correct: "Không có nhạc đệm"
    },
    {
        question: "Theo đoạn trích, quan họ truyền thống thường diễn ra vào dịp nào?",
        options: ["Lễ hội mùa xuân", "Lễ hội mùa hè", "Lễ hội mùa thu", "Lễ hội mùa đông"],
        correct: "Lễ hội mùa xuân"
    },
    {
        question: "Dân ca quan họ là di sản văn hóa của tỉnh nào?",
        options: ["Hà Nội", "Bắc Giang", "Bắc Ninh", "Hải Dương"],
        correct: "Bắc Ninh"
    },
    {
        question: "Theo đoạn trích, quan họ truyền thống có khán giả không?",
        options: ["Có khán giả", "Không có khán giả", "Chỉ có một số khán giả", "Chỉ có khán giả là người nước ngoài"],
        correct: "Không có khán giả"
    },
    {
        question: "Theo đoạn trích, điều gì tạo nên không khí gần gũi và thân mật khi hát quan họ?",
        options: ["Có nhiều nhạc cụ", "Không có khán giả", "Có nhiều người tham gia", "Có nhiều ánh sáng"],
        correct: "Không có khán giả"
    },
    {
        question: "Theo đoạn trích, du khách có thể trải nghiệm điều gì khi về miền quan họ?",
        options: ["Thưởng thức âm nhạc và ăn trầu", "Thưởng thức âm nhạc và uống rượu", "Thưởng thức âm nhạc và ăn bánh", "Thưởng thức âm nhạc và uống trà"],
        correct: "Thưởng thức âm nhạc và ăn trầu"
    },
    {
        question: "Theo đoạn trích, dân ca quan họ có vai trò gì đối với dân tộc Việt Nam?",
        options: ["Chỉ là di sản của Bắc Ninh", "Là niềm tự hào của cả dân tộc Việt Nam", "Chỉ là di sản của vùng đồng bằng Bắc Bộ", "Không có vai trò gì đặc biệt"],
        correct: "Là niềm tự hào của cả dân tộc Việt Nam"
    },
    {
        question: "Từ “đặc sản văn hóa” trong đoạn trích có thể được hiểu là gì?",
        options: ["Món ăn đặc biệt", "Di sản văn hóa độc đáo", "Món đồ thủ công mỹ nghệ", "Phong tục tập quán"],
        correct: "Di sản văn hóa độc đáo"
    }
];

        // Xử lý hiển thị văn bản với từ điển
        const content = document.getElementById('content');
        let showTranslation = false; // Default to hide translations

        function renderText() {
            let html = textContentData[0].replace(/\n/g, "<br>");
            if (showTranslation) {
                const sortedKeys = Object.keys(dictionary).sort((a, b) => b.length - a.length);
                const replacements = [];

                // Bước 1: Tìm và lưu trữ các cụm từ khớp
                sortedKeys.forEach(key => {
                    const regex = new RegExp(`(\\b|[.,!?\\n\\s]|^)(${key.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})(\\b|[.,!?\\n\\s]|$)`, 'gi');
                    let match;
                    while ((match = regex.exec(html)) !== null) {
                        const start = match.index + match[1].length;
                        const end = start + match[2].length;
                        replacements.push({
                            start,
                            end,
                            original: match[2],
                            prefix: match[1],
                            suffix: match[3],
                            translation: dictionary[key]
                        });
                    }
                });

                // Bước 2: Sắp xếp các lần khớp theo vị trí bắt đầu (start)
                replacements.sort((a, b) => a.start - b.start);

                // Bước 3: Lọc các lần khớp để loại bỏ chồng lấn
                const filteredReplacements = [];
                let lastEnd = -1;
                for (const replacement of replacements) {
                    if (replacement.start >= lastEnd) {
                        filteredReplacements.push(replacement);
                        lastEnd = replacement.end;
                    }
                }

                // Bước 4: Thay thế các cụm từ đã khớp, từ phải sang trái để tránh ảnh hưởng chỉ số
                for (let i = filteredReplacements.length - 1; i >= 0; i--) {
                    const { start, end, original, prefix, suffix, translation } = filteredReplacements[i];
                    const translatedHtml = `${prefix}<span class="translated-word"><span class="translation">${translation}</span><span class="original">${original}</span></span>${suffix}`;
                    html = html.slice(0, start - prefix.length) + translatedHtml + html.slice(end + suffix.length);
                }
            }
            content.innerHTML = html;
        }

        // Xử lý hiển thị ảnh
        const imageFrame = document.getElementById('imageFrame');
        const contentImage = document.getElementById('contentImage');
        const imageSrc = "anhminhhoa.png"; // Tên file ảnh cụ thể trong cùng thư mục
        function renderImage() {
            if (imageSrc) {
                contentImage.src = imageSrc;
                imageFrame.style.display = 'block';
            } else {
                imageFrame.style.display = 'none';
            }
        }

        // Gọi hàm renderText và renderImage khi khởi tạo
        renderText();
        renderImage();

        // Xử lý audio và bảng điều khiển
        const audioPlayer = document.getElementById("audioPlayer");
        const floatingControls = document.getElementById("floatingControls");
        const timeDisplay = floatingControls.querySelector("#timeDisplay");
        const loopStart = floatingControls.querySelector("#loopStart");
        const loopEnd = floatingControls.querySelector("#loopEnd");
        const loopButton = floatingControls.querySelector("#loopButton");
        const clearButton = floatingControls.querySelector("#clearButton");
        const rewind5sButton = floatingControls.querySelector("#rewind5sButton");
        const rewind1sButton = floatingControls.querySelector("#rewind1sButton");
        const forward1sButton = floatingControls.querySelector("#forward1sButton");
        const forward5sButton = floatingControls.querySelector("#forward5sButton");
        const pausePlayButton = floatingControls.querySelector("#pausePlayButton");
        const toggleControlsButton = floatingControls.querySelector("#toggleControlsButton");
        const toggleTranslationButton = document.getElementById("toggleTranslationButton");
        const tuaButtons = floatingControls.querySelector(".tua-buttons");

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function updateTimeDisplay(displayElement) {
            displayElement.textContent = formatTime(audioPlayer.currentTime);
        }

        let customLoopStart = null;
        let customLoopEnd = null;
        let clickCount = 0;
        let isLooping = false;

        const updateInterval = setInterval(() => updateTimeDisplay(timeDisplay), 1000);

        audioPlayer.ontimeupdate = function() {
            updateTimeDisplay(timeDisplay);
            if (isLooping && customLoopStart !== null && customLoopEnd !== null) {
                if (audioPlayer.currentTime >= customLoopEnd) {
                    audioPlayer.currentTime = customLoopStart;
                }
            }
        };

        timeDisplay.onclick = () => {
            if (audioPlayer.paused) {
                clickCount++;
                if (clickCount === 1) {
                    customLoopStart = audioPlayer.currentTime;
                    loopStart.textContent = formatTime(customLoopStart);
                } else if (clickCount === 2) {
                    customLoopEnd = audioPlayer.currentTime;
                    if (customLoopEnd <= customLoopStart) {
                        customLoopEnd = null;
                        loopEnd.textContent = "--:--";
                    } else {
                        loopEnd.textContent = formatTime(customLoopEnd);
                    }
                    clickCount = 0;
                }
            }
        };

        rewind5sButton.onclick = () => {
            if (!isLooping) {
                audioPlayer.currentTime = Math.max(0, audioPlayer.currentTime - 5);
                updateTimeDisplay(timeDisplay);
            }
        };
        rewind1sButton.onclick = () => {
            if (!isLooping) {
                audioPlayer.currentTime = Math.max(0, audioPlayer.currentTime - 1);
                updateTimeDisplay(timeDisplay);
            }
        };
        forward1sButton.onclick = () => {
            if (!isLooping) {
                audioPlayer.currentTime = Math.min(audioPlayer.duration, audioPlayer.currentTime + 1);
                updateTimeDisplay(timeDisplay);
            }
        };
        forward5sButton.onclick = () => {
            if (!isLooping) {
                audioPlayer.currentTime = Math.min(audioPlayer.duration, audioPlayer.currentTime + 5);
                updateTimeDisplay(timeDisplay);
            }
        };

        pausePlayButton.onclick = () => {
            if (audioPlayer.paused) {
                audioPlayer.play();
                pausePlayButton.textContent = "停";
            } else {
                audioPlayer.pause();
                pausePlayButton.textContent = "播";
            }
        };

        loopButton.onclick = () => {
            if (customLoopStart !== null && customLoopEnd !== null) {
                audioPlayer.currentTime = customLoopStart;
                audioPlayer.play();
                isLooping = true;
                rewind5sButton.disabled = true;
                rewind1sButton.disabled = true;
                forward1sButton.disabled = true;
                forward5sButton.disabled = true;
            }
        };

        clearButton.onclick = () => {
            customLoopStart = null;
            customLoopEnd = null;
            loopStart.textContent = "--:--";
            loopEnd.textContent = "--:--";
            clickCount = 0;
            isLooping = false;
            rewind5sButton.disabled = false;
            rewind1sButton.disabled = false;
            forward1sButton.disabled = false;
            forward5sButton.disabled = false;
        };

        let controlsVisible = true;
        toggleControlsButton.onclick = () => {
            if (controlsVisible) {
                timeDisplay.style.display = "none";
                tuaButtons.style.display = "none";
                pausePlayButton.style.display = "none";
                loopStart.style.display = "none";
                loopEnd.style.display = "none";
                loopButton.style.display = "none";
                clearButton.style.display = "none";
                toggleControlsButton.textContent = "示";
                controlsVisible = false;
            } else {
                timeDisplay.style.display = "inline-block";
                tuaButtons.style.display = "flex";
                pausePlayButton.style.display = "inline-flex";
                loopStart.style.display = "inline-block";
                loopEnd.style.display = "inline-block";
                loopButton.style.display = "inline-flex";
                clearButton.style.display = "inline-flex";
                toggleControlsButton.textContent = "藏";
                controlsVisible = true;
            }
        };

        toggleTranslationButton.onclick = () => {
            showTranslation = !showTranslation;
            toggleTranslationButton.textContent = showTranslation ? "藏" : "示";
            renderText();
        };

        audioPlayer.onpause = audioPlayer.onended = function() {
            pausePlayButton.textContent = "播";
        };

        // Biến lưu trữ vị trí cuộn và lựa chọn
        let contentScrollPosition = 0;
        let quizScrollPosition = 0;
        let userSelections = {};
        let isSubmitted = false;

        // Hiển thị câu hỏi và khôi phục lựa chọn
        function loadQuiz() {
            const questionsDiv = document.getElementById('questions');
            questionsDiv.innerHTML = '';
            quizData.forEach((item, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question';
                
                const questionTitle = document.createElement('h3');
                questionTitle.textContent = `Câu ${index + 1}: ${item.question}`;
                questionDiv.appendChild(questionTitle);

                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'options';
                
                item.options.forEach(option => {
                    const label = document.createElement('label');
                    const isChecked = userSelections[`question${index}`] === option ? 'checked' : '';
                    label.innerHTML = `
                        <input type="radio" name="question${index}" value="${option}" ${isChecked}>
                        ${option}
                    `;
                    optionsDiv.appendChild(label);
                });

                questionDiv.appendChild(optionsDiv);
                questionsDiv.appendChild(questionDiv);
            });

            // Khôi phục vị trí cuộn
            window.scrollTo(0, quizScrollPosition);
        }

        // Lưu lựa chọn của người dùng
        function saveSelections() {
            quizData.forEach((_, index) => {
                const selected = document.querySelector(`input[name="question${index}"]:checked`);
                if (selected) {
                    userSelections[`question${index}`] = selected.value;
                }
            });
        }

        // Kiểm tra đáp án
        function checkAnswers() {
            let score = 0;
            const total = quizData.length;
            let wrongAnswers = [];
            
            quizData.forEach((item, index) => {
                const selected = document.querySelector(`input[name="question${index}"]:checked`);
                if (selected) {
                    if (selected.value === item.correct) {
                        score++;
                    } else {
                        wrongAnswers.push({
                            question: item.question,
                            selected: selected.value,
                            correct: item.correct
                        });
                    }
                } else {
                    wrongAnswers.push({
                        question: item.question,
                        selected: "未选择",
                        correct: item.correct
                    });
                }
            });

            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <h3>YD-Visa-结果: ${score}/${total} 答案正确</h3>
                <p>比例: ${(score/total * 100).toFixed(2)}%</p>
            `;

            if (wrongAnswers.length > 0) {
                resultDiv.innerHTML += '<h4>错误答案:</h4>';
                wrongAnswers.forEach((wrong, index) => {
                    resultDiv.innerHTML += `
                        <div class="wrong-answer">
                            Câu ${quizData.findIndex(q => q.question === wrong.question) + 1}: ${wrong.question}<br>
                            你的选择: ${wrong.selected} - 正确答案: ${wrong.correct}
                        </div>
                    `;
                });
            } else {
                resultDiv.innerHTML += '<p>回答正确所有问题</p>';
            }

            resultDiv.scrollIntoView({ behavior: 'smooth' });
            isSubmitted = true; // Đánh dấu đã nộp bài
        }

        // Xử lý chế độ hiển thị
        const contentModeButton = document.getElementById('contentMode');
        const quizModeButton = document.getElementById('quizMode');
        const contentContainer = document.getElementById('contentContainer');
        const quizContainer = document.getElementById('quizContainer');

        contentModeButton.addEventListener('click', () => {
            // Lưu vị trí cuộn của quiz trước khi chuyển
            quizScrollPosition = window.scrollY;
            saveSelections(); // Lưu lựa chọn của người dùng
            
            contentContainer.style.display = 'block';
            quizContainer.style.display = 'none';
            contentModeButton.classList.add('active');
            quizModeButton.classList.remove('active');
            floatingControls.style.display = 'block';
            toggleTranslationButton.style.display = 'inline-block'; // Show translation button
            renderText();
            renderImage();
            
            // Khôi phục vị trí cuộn của content
            window.scrollTo(0, contentScrollPosition);
        });

        quizModeButton.addEventListener('click', () => {
            // Lưu vị trí cuộn của content trước khi chuyển
            contentScrollPosition = window.scrollY;
            saveSelections(); // Lưu lựa chọn của người dùng
            
            contentContainer.style.display = 'none';
            quizContainer.style.display = 'block';
            quizModeButton.classList.add('active');
            contentModeButton.classList.remove('active');
            floatingControls.style.display = 'none';
            toggleTranslationButton.style.display = 'none'; // Hide translation button
            
            // Reset lựa chọn nếu đã nộp bài
            if (isSubmitted) {
                userSelections = {};
                isSubmitted = false;
            }
            
            loadQuiz();
        });

        // Mặc định hiển thị nội dung
        contentContainer.style.display = 'block';
        quizContainer.style.display = 'none';
        toggleTranslationButton.style.display = 'inline-block'; // Show translation button initially
    </script>
</body>
</html>